##
## RetroArch-related features.
##
## dragonshark-enumerate-external-device-dirs
## dragonshark-set-roms-dir
## dragonshark-get-roms-dir

# Enumerates the media directories belonging to mounted devices.
# The enumerated directories belong to /media/$USER.
function dragonshark-enumerate-media-dirs() {
    lsblk -o MOUNTPOINT | grep "/media/$USER"
}

# Sets the new ROMs directory. The directory must exist and also
# belong to /media/$USER.
function dragonshark-set-roms-dir() {
    if [[ ! -d "$1" ]]
    then
        echo "The given roms dir does not exist" 1>&2
        return 2
    fi

    dragonshark-enumerate-media-dirs | grep "$1"
    if [[ ! $? ]]
    then
        echo "The given roms dir is not an external media directory" 1>&2
        return 1
    fi

    sed 's|%ROMS%|$1|g' $HOME/.emulationstation/es_systems.template.cfg > $HOME/.emulationstation/es_systems.cfg
}

# Gets the new ROMs directory.
function dragonshark-get-roms-dir() {
    cat ~/.emulationstation/es_systems.cfg | grep -Po "<path>\K.*(?=</path>)" | head -n 1 | grep -Po "/media/pi/[^/]+"
}
